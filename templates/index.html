<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenProBono | Agents</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.png">
    <style>
        body, html {
            height: 100%;
            font-family: "DM Sans", sans-serif;
            font-optical-sizing: auto;
            background-image: url('../static/images/bg.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .wrapper {
            display: flex;
            height: 100%;
        }
        .sidebar {
            width: 300px;
            padding: 20px;
            border-right: 2px solid #737373;
            overflow-y: auto;
            background-color: #f0f0f0;
        }
        .right-sidebar {
            width: 300px;
            background-color: #f0f0f0;
            padding: 20px;
            border-left: 2px solid #737373;
            overflow-y: auto;
        }
        .content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .chat-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 2px solid #737373;
            background-color: #f0f0f0;
        }
        .message {
            margin-bottom: 15px;
        }
        .user-message {
            background-color: #5c28df;
            color: white;
            border-radius: 10px 10px 0 10px;
            padding: 10px;
            max-width: 70%;
            margin-left: auto;
        }
        .bot-message-container {
            display: flex;
            flex-direction: column;
            max-width: 70%;
        }
        .bot-message {
            background-color: #f8fcfd;
            border-radius: 10px 10px 10px 0;
            padding: 10px;
        }
        .message-icons {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .message-icon {
            cursor: pointer;
            color: #6c757d;
        }
        .message-icon:hover {
            color: #0056b3;
        }
        .file-upload {
            margin-bottom: 15px;
        }
        .file-list {
            margin-top: 10px;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .file-thumbnails {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .file-thumbnail {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }
        .file-thumbnail i {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        .file-thumbnail span {
            font-size: 0.8rem;
            text-align: center;
            word-break: break-all;
            max-width: 100%;
        }
        .disclaimer {
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            text-align: justify;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="sidebar">
            <h3 class="mb-4">Agent Menu</h3>
            <div class="mb-1">Tools</div>
            <form>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="government-search" checked>
                        <label class="form-check-label" for="government-search">Legislation Search</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="courtlistener-search" checked>
                        <label class="form-check-label" for="courtlistener-search">Case Search</label>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="provider" class="form-label">Provider</label>
                    <select class="form-select" id="provider">
                        <option selected value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="model" class="form-label">Model</label>
                    <select class="form-select" id="model">
                        <option selected value="gpt-4o-mini">GPT-4o mini</option>
                        <option value="gpt-4o">GPT-4o</option>
                    </select>
                </div>
            </form>

        </div>

        <div class="content">
            <div class="disclaimer">
                <h4 class="mb-3">Disclaimer</h4>
                <p>OpenProBono AI is designed to assist users in finding relevant information and resources related to government and laws. While we strive to provide accurate and up-to-date information, our AI is not an attorney and does not provide legal advice. Users are urged to consult with legal professionals for specific legal matters.</p>
                <p>AI results should be verified against official sources. Additionally, AI recommendations and suggestions are based on algorithms and data analysis, and may not cover all possible scenarios or legal interpretations. Developers do not assume any liability for the accuracy, completeness, or reliability of AI responses and sources. Users are responsible for independently verifying information and using their own judgment to make legal decisions.</p>
                <p>By using OpenProBono AI, you agree to the above and following terms:</p>
                <ul>
                    <li>OpenProBono AI is for informational and educational purposes only.</li>
                    <li>OpenProBono AI does not offer legal advice.</li>
                    <li>Information provided to OpenProBono AI will not create a client-lawyer relationship and is not confidential or privileged.</li>
                    <li>OpenProBono AI may not provide accurate or reliable information.</li>
                    <li>You use OpenProBono AI at your own risk.</li>
                    <li>OpenProBono is not responsible for any consequences arising from the use of its AI or its results.</li>
                </ul>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="acceptDisclaimer()">I Agree</button>
                    <button class="btn btn-secondary" onclick="declineDisclaimer()">Decline</button>
                </div>
            </div>
            <div class="chat-container rounded p-3" style="display:none;">
                <div id="chat-messages"></div>
            </div>
            <div class="file-upload" style="display:none;">
                <input type="file" id="file-input" class="form-control" multiple accept=".txt,.doc,.docx,.pdf" onchange="handleFileUpload(this.files)">
                <div id="file-list" class="file-list"></div>
            </div>
            <div class="input-group mb-3" style="display:none;">
                <input type="text" id="user-input" class="form-control" placeholder="Type your message...">
                <button class="btn btn-primary col-1" type="button" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <div class="right-sidebar">
            <h3 class="mb-4">Sources</h3>
            <div id="source-list" class="source-list">
                <!-- Sources will be dynamically added here -->
            </div>
        </div>
    </div>

    <div class="modal fade" id="likeModal" tabindex="-1" aria-labelledby="likeModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Feedback</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="likeForm">
                        <div class="mb-3">
                            <label for="feedbackText" class="form-label">Please share your feedback (optional):</label>
                            <textarea class="form-control" id="feedbackText" rows="3" placeholder="What did you like about this response?"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="dislikeModal" tabindex="-1" aria-labelledby="dislikeModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Feedback</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="dislikeForm">
                        <div class="mb-3">
                            <p>What type of issue are you reporting? Choose all that apply (optional).</p>
                            <select class="form-select" multiple aria-label="Dislike category">
                                <option selected>Other</option>
                                <option value="inaccurate">Inaccurate</option>
                                <option value="out of date">Out of date</option>
                                <option value="misleading">Misleading/irrelevant</option>
                                <option value="too short">Too short</option>
                                <option value="too long">Too long</option>
                                <option value="harmful or offensive">Harmful or offensive</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="feedbackText" class="form-label">Please share your feedback (optional):</label>
                            <textarea class="form-control" id="feedbackText" rows="3" placeholder="What did you not like about this response?"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        function acceptDisclaimer() {
            document.querySelector('.disclaimer').style.display = 'none';
            document.querySelector('.chat-container').style.display = 'block';
            document.querySelector('.file-upload').style.display = 'block';
            document.querySelector('.input-group').style.display = 'flex';
        }

        function declineDisclaimer() {
            alert('You must accept the disclaimer to use OpenProBono Agents.');
        }

        let uploadedFiles = [];

        function handleFileUpload(files) {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';

            for (let i = 0; i < files.length && uploadedFiles.length < 5; i++) {
                const file = files[i];
                if (file.size <= 5 * 1024 * 1024) { // 5MB in bytes
                    uploadedFiles.push(file);
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <span>${file.name}</span>
                        <button class="btn btn-sm btn-danger" onclick="removeFile(${uploadedFiles.length - 1})">Remove</button>
                    `;
                    fileList.appendChild(fileItem);
                } else {
                    alert(`File ${file.name} is larger than 5MB and won't be uploaded.`);
                }
            }

            if (files.length > 5) {
                alert('Maximum of 5 files allowed. Only the first 5 files have been added.');
            }

            document.getElementById('file-input').value = '';
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
        }

        function updateFileList() {
            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name}</span>
                    <button class="btn btn-sm btn-danger" onclick="removeFile(${index})">Remove</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function getFileIcon(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            switch (extension) {
                case 'txt': return 'bi-file-text';
                case 'doc':
                case 'docx': return 'bi-file-word';
                case 'pdf': return 'bi-file-pdf';
                default: return 'bi-file-earmark';
            }
        }

        feedbackAction = '';
        function setFeedbackAction(element) {
            feedbackAction = element.title;
            console.log(feedbackAction);
        }

        function sendMessage() {
            const userInput = document.getElementById('user-input');
            const chatMessages = document.getElementById('chat-messages');
            const sourceList = document.getElementById('source-list');

            if (userInput.value.trim() !== '' || uploadedFiles.length > 0) {
                // Add user message
                const userMessage = document.createElement('div');
                userMessage.className = 'message';
                let messageContent = userInput.value;
                
                if (uploadedFiles.length > 0) {
                    messageContent += '<div class="file-thumbnails">';
                    uploadedFiles.forEach(file => {
                        const icon = getFileIcon(file.name);
                        messageContent += `
                            <div class="file-thumbnail">
                                <i class="bi ${icon}"></i>
                                <span>${file.name}</span>
                            </div>
                        `;
                    });
                    messageContent += '</div>';
                }
                
                userMessage.innerHTML = `<div class="user-message">${messageContent}</div>`;
                chatMessages.appendChild(userMessage);

                // Add bot message with icons (unchanged)
                const botMessageContainer = document.createElement('div');
                botMessageContainer.className = 'message bot-message-container';
                botMessageContainer.innerHTML = `
                    <div class="bot-message">Thanks for your message! This is a placeholder response.</div>
                    <div class="message-icons">
                        <i class="bi bi-hand-thumbs-up message-icon" data-bs-toggle="modal" data-bs-target="#likeModal" onclick="setFeedbackAction(this)" title="Like"></i>
                        <i class="bi bi-hand-thumbs-down message-icon" data-bs-toggle="modal" data-bs-target="#dislikeModal" onclick="setFeedbackAction(this)" title="Dislike"></i>
                        <i class="bi bi-clipboard message-icon" onclick="copyMessage(this)" title="Copy"></i>
                    </div>
                `;
                chatMessages.appendChild(botMessageContainer);

                // Clear input, file list, and scroll to bottom
                userInput.value = '';
                uploadedFiles = [];
                updateFileList();
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Add mock sources (replace this with actual source generation logic)
                sourceList.innerHTML = ''; // Clear previous sources
                const mockSources = [
                    { title: "Wikipedia - Chatbots", url: "https://en.wikipedia.org/wiki/Chatbot", text: "Chatbots are a type of software agent that can converse, make decisions, and perform actions." },
                    { title: "Scientific American - The ChatGPT Hype", url: "https://www.scientificamerican.com/article/the-chatgpt-hype/", text: "ChatGPT is a chatbot that uses GPT-2 to generate text." },
                    { title: "Nature - AI chatbots in research", url: "https://www.nature.com/articles/d41586-023-00340-6", text: "AI chatbots are being used in research to help people with mental health issues." }
                ];
                mockSources.forEach(source => {
                    const sourceItem = document.createElement('div');
                    sourceItem.className = "card mb-3";
                    sourceItem.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title"><a href="${source.url}" target="_blank">${source.title}</a></h5>
                            <p class="card-text">${source.text}</p>
                        </div>
                    `;
                    sourceList.appendChild(sourceItem);
                });
            }
        }

        function copyMessage(element) {
            const messageText = element.closest('.bot-message-container').querySelector('.bot-message').textContent;
            navigator.clipboard.writeText(messageText).then(() => {
                alert('Message copied to clipboard!');
            });
        }

        // Allow sending message with Enter key
        document.getElementById('user-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Dependent provider and model dropdowns
        document.getElementById('provider').addEventListener('click', function () {
            let provider = this.value;
            let models = document.getElementById("model");
            if (provider === "openai") {
                models.innerHTML = `
                    <option selected value="gpt-4o-mini">GPT-4o mini</option>
                    <option value="gpt-4o">GPT-4o</option>
                `;
            } else if (provider === "anthropic") {
                models.innerHTML = `
                    <option selected value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                    <option value=claude-3-5-sonnet-20240620">Claude 3.5 Sonnet</option>
                `;
            }
        });
    </script>
</body>
</html>